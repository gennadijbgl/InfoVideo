"use strict";(function(n,t,i){var c,e,o,y,v,h,l,s,p;if(n.ion=n.ion||{},!ion.sound){if(c=function(t){var r,u;t||(t="undefined");n.console&&(console.warn&&typeof console.warn=="function"?console.warn(t):console.log&&typeof console.log=="function"&&console.log(t),r=i&&i("#debug"),r&&r.length&&(u=r.html(),r.html(u+t+"<br/>")))},e=function(n,t){var i;t=t||{};for(i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);return t},typeof Audio!="function"&&typeof Audio!="object"){o=function(){c("HTML5 Audio is not supported in this browser")};ion.sound=o;ion.sound.play=o;ion.sound.stop=o;ion.sound.pause=o;ion.sound.preload=o;ion.sound.destroy=o;o();return}var w=/iPad|iPhone|iPod/.test(t.appVersion),a=0,u={},f={},r;(!u.supported&&w?u.supported=["mp3","mp4","aac"]:u.supported||(u.supported=["mp3","ogg","mp4","aac","wav"]),y=function(n){var t=n.alias||n.name;f[t]||(f[t]=new l(n),f[t].init())},ion.sound=function(n){if(e(n,u),u.path=u.path||"",u.volume=u.volume||1,u.preload=u.preload||!1,u.multiplay=u.multiplay||!1,u.loop=u.loop||!1,u.sprite=u.sprite||null,u.scope=u.scope||null,u.ready_callback=u.ready_callback||null,u.ended_callback=u.ended_callback||null,a=u.sounds.length,!a){c("No sound-files provided!");return}for(r=0;r<a;r++)y(u.sounds[r])},ion.sound.VERSION="3.0.7",ion.sound._method=function(n,t,i){if(t)f[t]&&f[t][n](i);else for(r in f)f.hasOwnProperty(r)&&f[r]&&f[r][n](i)},ion.sound.preload=function(n,t){t=t||{};e({preload:!0},t);ion.sound._method("init",n,t)},ion.sound.destroy=function(n){if(ion.sound._method("destroy",n),n)f[n]=null;else for(r in f)f.hasOwnProperty(r)&&f[r]&&(f[r]=null)},ion.sound.play=function(n,t){ion.sound._method("play",n,t)},ion.sound.stop=function(n,t){ion.sound._method("stop",n,t)},ion.sound.pause=function(n,t){ion.sound._method("pause",n,t)},ion.sound.volume=function(n,t){ion.sound._method("volume",n,t)},i&&(i.ionSound=ion.sound),v=n.AudioContext||n.webkitAudioContext,v&&(h=new v),l=function(n){this.options=e(u);delete this.options.sounds;e(n,this.options);this.request=null;this.streams={};this.result={};this.ext=0;this.url="";this.loaded=!1;this.decoded=!1;this.no_file=!1;this.autoplay=!1},l.prototype={init:function(n){n&&e(n,this.options);this.options.preload&&this.load()},destroy:function(){var n;for(r in this.streams)n=this.streams[r],n&&(n.destroy(),n=null);this.streams={};this.result=null;this.options.buffer=null;this.options=null;this.request&&(this.request.removeEventListener("load",this.ready.bind(this),!1),this.request.removeEventListener("error",this.error.bind(this),!1),this.request.abort(),this.request=null)},createUrl:function(){var n=(new Date).valueOf();this.url=this.options.path+encodeURIComponent(this.options.name)+"."+this.options.supported[this.ext]+"?"+n},load:function(){if(this.no_file){c('No sources for "'+this.options.name+'" sound :(');return}this.request||(this.createUrl(),this.request=new XMLHttpRequest,this.request.open("GET",this.url,!0),this.request.responseType="arraybuffer",this.request.addEventListener("load",this.ready.bind(this),!1),this.request.addEventListener("error",this.error.bind(this),!1),this.request.send())},reload:function(){this.ext++;this.options.supported[this.ext]?this.load():(this.no_file=!0,c('No sources for "'+this.options.name+'" sound :('))},ready:function(n){if(this.result=n.target,this.result.readyState!==4){this.reload();return}if(this.result.status!==200&&this.result.status!==0){c(this.url+" was not found on server!");this.reload();return}this.request.removeEventListener("load",this.ready.bind(this),!1);this.request.removeEventListener("error",this.error.bind(this),!1);this.request=null;this.loaded=!0;this.decode()},decode:function(){h&&h.decodeAudioData(this.result.response,this.setBuffer.bind(this),this.error.bind(this))},setBuffer:function(n){this.options.buffer=n;this.decoded=!0;var t={name:this.options.name,alias:this.options.alias,ext:this.options.supported[this.ext],duration:this.options.buffer.duration};if(this.options.ready_callback&&typeof this.options.ready_callback=="function"&&this.options.ready_callback.call(this.options.scope,t),this.options.sprite)for(r in this.options.sprite)this.options.start=this.options.sprite[r][0],this.options.end=this.options.sprite[r][1],this.streams[r]=new s(this.options,r);else this.streams[0]=new s(this.options);this.autoplay&&(this.autoplay=!1,this.play())},error:function(){this.reload()},play:function(n){if(delete this.options.part,n&&e(n,this.options),!this.loaded){this.autoplay=!0;this.load();return}if(!this.no_file&&this.decoded)if(this.options.sprite)if(this.options.part)this.streams[this.options.part].play(this.options);else for(r in this.options.sprite)this.streams[r].play(this.options);else this.streams[0].play(this.options)},stop:function(n){if(this.options.sprite)if(n)this.streams[n.part].stop();else for(r in this.options.sprite)this.streams[r].stop();else this.streams[0].stop()},pause:function(n){if(this.options.sprite)if(n)this.streams[n.part].pause();else for(r in this.options.sprite)this.streams[r].pause();else this.streams[0].pause()},volume:function(n){var t;if(n)e(n,this.options);else return;if(this.options.sprite)if(this.options.part)t=this.streams[this.options.part],t&&t.setVolume(this.options);else for(r in this.options.sprite)t=this.streams[r],t&&t.setVolume(this.options);else t=this.streams[0],t&&t.setVolume(this.options)}},s=function(n,t){this.alias=n.alias;this.name=n.name;this.sprite_part=t;this.buffer=n.buffer;this.start=n.start||0;this.end=n.end||this.buffer.duration;this.multiplay=n.multiplay||!1;this.volume=n.volume||1;this.scope=n.scope;this.ended_callback=n.ended_callback;this.setLoop(n);this.source=null;this.gain=null;this.playing=!1;this.paused=!1;this.time_started=0;this.time_ended=0;this.time_played=0;this.time_offset=0},s.prototype={destroy:function(){this.stop();this.buffer=null;this.source=null;this.gain&&this.gain.disconnect();this.source&&this.source.disconnect();this.gain=null;this.source=null},setLoop:function(n){this.loop=n.loop===!0?9999999:typeof n.loop=="number"?+n.loop-1:!1},update:function(n){this.setLoop(n);"volume"in n&&(this.volume=n.volume)},play:function(n){(n&&this.update(n),this.multiplay||!this.playing)&&(this.gain=h.createGain(),this.source=h.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.gain),this.gain.connect(h.destination),this.gain.gain.value=this.volume,this.source.onended=this.ended.bind(this),this._play())},_play:function(){var t,n;if(this.paused?(t=this.start+this.time_offset,n=this.end-this.time_offset):(t=this.start,n=this.end),n<=0){this.clear();return}typeof this.source.start=="function"?this.source.start(0,t,n):this.source.noteOn(0,t,n);this.playing=!0;this.paused=!1;this.time_started=(new Date).valueOf()},stop:function(){this.playing&&this.source&&(typeof this.source.stop=="function"?this.source.stop(0):this.source.noteOff(0));this.clear()},pause:function(){if(this.paused){this.play();return}this.playing&&(this.source&&this.source.stop(0),this.paused=!0)},ended:function(){this.playing=!1;this.time_ended=(new Date).valueOf();this.time_played=(this.time_ended-this.time_started)/1e3;this.time_offset+=this.time_played;(this.time_offset>=this.end||this.end-this.time_offset<.015)&&(this._ended(),this.clear(),this.loop&&(this.loop--,this.play()))},_ended:function(){var n={name:this.name,alias:this.alias,part:this.sprite_part,start:this.start,duration:this.end};this.ended_callback&&typeof this.ended_callback=="function"&&this.ended_callback.call(this.scope,n)},clear:function(){this.time_played=0;this.time_offset=0;this.paused=!1;this.playing=!1},setVolume:function(n){this.volume=n.volume;this.gain&&(this.gain.gain.value=this.volume)}},h)||(p=function(){for(var i=new Audio,f=i.canPlayType("audio/mpeg"),e=i.canPlayType("audio/ogg"),r=i.canPlayType('audio/mp4; codecs="mp4a.40.2"'),t,n=0;n<u.supported.length;n++)t=u.supported[n],f||t!=="mp3"||u.supported.splice(n,1),e||t!=="ogg"||u.supported.splice(n,1),r||t!=="aac"||u.supported.splice(n,1),r||t!=="mp4"||u.supported.splice(n,1);i=null},p(),l.prototype={init:function(n){n&&e(n,this.options);this.inited=!0;this.options.preload&&this.load()},destroy:function(){var n;for(r in this.streams)n=this.streams[r],n&&(n.destroy(),n=null);this.streams={};this.loaded=!1;this.inited=!1},load:function(){var n;if(this.options.preload=!0,this.options._ready=this.ready,this.options._scope=this,this.options.sprite)for(r in this.options.sprite)n=this.options.sprite[r],this.options.start=n[0],this.options.end=n[1],this.streams[r]=new s(this.options,r);else this.streams[0]=new s(this.options)},ready:function(n){if(!this.loaded){this.loaded=!0;var t={name:this.options.name,alias:this.options.alias,ext:this.options.supported[this.ext],duration:n};this.options.ready_callback&&typeof this.options.ready_callback=="function"&&this.options.ready_callback.call(this.options.scope,t);this.autoplay&&(this.autoplay=!1,this.play())}},play:function(n){if(this.inited){if(delete this.options.part,n&&e(n,this.options),console.log(1),!this.loaded){this.options.preload?this.autoplay=!0:(this.autoplay=!0,this.load());return}if(this.options.sprite)if(this.options.part)this.streams[this.options.part].play(this.options);else for(r in this.options.sprite)this.streams[r].play(this.options);else this.streams[0].play(this.options)}},stop:function(n){if(this.inited)if(this.options.sprite)if(n)this.streams[n.part].stop();else for(r in this.options.sprite)this.streams[r].stop();else this.streams[0].stop()},pause:function(n){if(this.inited)if(this.options.sprite)if(n)this.streams[n.part].pause();else for(r in this.options.sprite)this.streams[r].pause();else this.streams[0].pause()},volume:function(n){var t;if(n)e(n,this.options);else return;if(this.options.sprite)if(this.options.part)t=this.streams[this.options.part],t&&t.setVolume(this.options);else for(r in this.options.sprite)t=this.streams[r],t&&t.setVolume(this.options);else t=this.streams[0],t&&t.setVolume(this.options)}},s=function(n,t){this.name=n.name;this.alias=n.alias;this.sprite_part=t;this.multiplay=n.multiplay;this.volume=n.volume;this.preload=n.preload;this.path=u.path;this.start=n.start||0;this.end=n.end||0;this.scope=n.scope;this.ended_callback=n.ended_callback;this._scope=n._scope;this._ready=n._ready;this.setLoop(n);this.sound=null;this.url=null;this.loaded=!1;this.start_time=0;this.paused_time=0;this.played_time=0;this.init()},s.prototype={init:function(){this.sound=new Audio;this.sound.volume=this.volume;this.createUrl();this.sound.addEventListener("ended",this.ended.bind(this),!1);this.sound.addEventListener("canplaythrough",this.can_play_through.bind(this),!1);this.sound.addEventListener("timeupdate",this._update.bind(this),!1);this.load()},destroy:function(){this.stop();this.sound.removeEventListener("ended",this.ended.bind(this),!1);this.sound.removeEventListener("canplaythrough",this.can_play_through.bind(this),!1);this.sound.removeEventListener("timeupdate",this._update.bind(this),!1);this.sound=null;this.loaded=!1},createUrl:function(){var n=(new Date).valueOf();this.url=this.path+encodeURIComponent(this.name)+"."+u.supported[0]+"?"+n},can_play_through:function(){this.preload&&this.ready()},load:function(){this.sound.src=this.url;this.sound.preload=this.preload?"auto":"none";this.preload&&this.sound.load()},setLoop:function(n){this.loop=n.loop===!0?9999999:typeof n.loop=="number"?+n.loop-1:!1},update:function(n){this.setLoop(n);"volume"in n&&(this.volume=n.volume)},ready:function(){!this.loaded&&this.sound&&(this.loaded=!0,this._ready.call(this._scope,this.sound.duration),this.end||(this.end=this.sound.duration))},play:function(n){(n&&this.update(n),this.multiplay||!this.playing)&&this._play()},_play:function(){if(this.paused)this.paused=!1;else try{this.sound.currentTime=this.start}catch(n){}this.playing=!0;this.start_time=(new Date).valueOf();this.sound.volume=this.volume;this.sound.play()},stop:function(){if(this.playing){this.playing=!1;this.paused=!1;this.sound.pause();this.clear();try{this.sound.currentTime=this.start}catch(n){}}},pause:function(){this.paused?this._play():(this.playing=!1,this.paused=!0,this.sound.pause(),this.paused_time=(new Date).valueOf(),this.played_time+=this.paused_time-this.start_time)},_update:function(){if(this.start_time){var n=(new Date).valueOf(),t=n-this.start_time,i=(this.played_time+t)/1e3;i>=this.end&&this.playing&&(this.stop(),this._ended())}},ended:function(){this.playing&&(this.stop(),this._ended())},_ended:function(){this.playing=!1;var n={name:this.name,alias:this.alias,part:this.sprite_part,start:this.start,duration:this.end};this.ended_callback&&typeof this.ended_callback=="function"&&this.ended_callback.call(this.scope,n);this.loop&&setTimeout(this.looper.bind(this),15)},looper:function(){this.loop--;this.play()},clear:function(){this.start_time=0;this.played_time=0;this.paused_time=0},setVolume:function(n){this.volume=n.volume;this.sound&&(this.sound.volume=this.volume)}})}})(window,navigator,window.jQuery||window.$);